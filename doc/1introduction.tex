\chapter{Introduction}

%TODO scheiding domain overview in algemeen (wsn->iot->lpwa) en qos specific
%TODO application types
\section{Domain overview} 
Wireless Sensor Networks (WSNs) have received large amounts of research the past decades. However this mainly resulted in isolated ad hoc networks. With both the size of WSN's and the amount of networks increasing, the deployment of multiple networks in the same geographical area for different applications seemed increasingly illogical. Therefore, recent endeavours have attempted design networks and protocols in order to create a general, ubiquitous internet for automated devices and sensors: the Internet of Things (IoT). A specific recent development in IoT has focussed on the field of Low Power Wide Area networks (LPWA). These networks serve devices that communicate over large distances with very limited computational and communication resources. They therefore entail low data rates, low radio frequencies and raw unprocessed data. 

These extremely restrictive requirements entail that a regular wireless internet connection does not suffice, as it is not optimized for the extreme resource limitations of LPWA IoT applications. Multiple corporations are developing and deploying exclusive wide area networks for low powered devices. Examples of these networks are Narrow-Band IoT\cite{nbiot}, LoRaWAN\cite{web:lora} and Sigfox\cite{web:sigfox}. These networks are deployed and operated by telcom providers and allow instant connectivity by incorporating a SIM or proprietary network connectivity module. As a consequence large scale LPWA applications are moving from node-hopping and mesh network strategies to operated cell networks\cite{needs source}. Because of the aforementioned reasons the number of connected devices has exploded in the recent years. Estimations vary but a consensus established from multiple sources predict about 15-30 billion connected devices in 2020. This would imply that by 2020 the number of connected IoT devices will have surpassed the number of consumer electronic devices (e.g. PC's, laptops and phones)\cite{nr_devices_ericsson}. 

Both the explosion of devices, entailing explosion of data, and the shift to shared operated cell networks implies a great stress on monitoring sensor applications. While relatively small sized applications on proprietary networks allow for a best-effort approach, the convolution of many large applications on a shared network requires knowledge of the performance provided by the application. The term coined for this is Quality of Service (QoS). QoS parameters such as application throughput, service availability and message drop allow the description of the performance state of a system or application. It is therefore paramount for a commercial application to have its QoS metrics observed. 

The notion of QoS in a networked application is not a novel concept. It has been a research and industry paradigm for as long as commercial applications have existed. Consequently many forms of QoS monitoring and management exist for regular internet and networking applications. However, these methods do not transfer well to the field of WSN and IoT, as will become apparent in this section. This presents a vacancy that requires exploration. Access to such QoS solutions will improve the maturity and operational feasibility of commercial, large-scale IoT applications.

The remainder of this introductory chapter will determine some of the key challenges which differentiate QoS monitoring of regular networks and wireless sensor networks. The next section will deliberate some key obstacles in the current state of art of monitoring Quality of Service in LPWA Wireless Sensor Networks. Subsequently, it will be deliberated why existing solutions cannot provide for the QoS monitoring  needs of LPWA applications. After which the succeeding section will introduce the proposed approach to design a development platform for applications to deal with these challenges and capture the QoS in WSN's.
%TODO WSN & IoT interchangeble


\section{Challenges in monitoring QoS in LPWA}
\label{sec:challenges}
Three key challenges were identified that fundamentally complicate QoS measurement and management in LPWA networks and applications. These challenges affect the applicability of conventional QoS mechanisms to the field of IoT and WSN. %These causes will be shortly deliberated individually before summarizing the implications they effect on the domain of QoS monitoring.

\subsubsection{Technical limitations of end-devices}
The first challenge of LPWA applications are the previously mentioned extreme resource constraints. For example, LPWA devices are expected to communicate on a network shared by a vast amount of nodes, diminishing the individual connectivity resources. As a consequence, uplink communication is regularly argegated overtime and transmitted opportunistically. Therefore, back-end applications are required to facilitate irregular and infrequent reporting intervals from sensor nodes. Additionally, an LPWA device is required to perform for a certain amount of time (typically at least 10 years\cite{tmobile, vodafone}) on a finite battery energy supply. Therefore, there are no resources to spare for expensive auxiliary processes. Consequently, devices usually send low-level auxiliary data, instead of intelligently derived values. The burden of calculating high level information is then deferred to be computed in-network (edge computing) or in the back-end. 

Additionally, evolution of sensor device software is far more restrictive then evolution of back-end application's software. Firstly because of the long life-time of devices, it can occur that services based on modern day requirements need to be performed by decade old technology. Secondly, most LPWA networking protocols do not require devices to retain a constant connection in order to save energy\cite{tmobile, vodafone, iets met nbiot specs}. Instead the devices connect periodically or when an event/interrupt occurs. This entails that devices are not updated \emph{en masse}, but individually when a device wakes up. As this requires additional resends of the updated code it consumes more connectivity resources in the network. For these reasons LPWA sensor applications often employ a \emph{"dumb sensor, smart back-end"} philosophy. Again deferring the computations to the network or the back-end.

The problem however with deferring the computations further to the back-end is that more and more computations have to be performed centralized. This requires the back-end to be extremely scalable because more tasks need to be performed as more devices are added to the application.

\subsubsection{IoT QoS is different}
Aside from the low-level information sent by the large amount of devices, QoS in WSNs is distinctly different from classical client-server QoS. Often QoS in a client-server application can be measured at the server. QoS monitoring in a cloud environment may require some aggregation of data, but even then the number of data sources is relatively limited. Large WSN applications require data aggregation by default. As the Quality of Service provided by the application can only be ascertained by calculations based on auxiliary data collected from a huge number of devices. This concept is known as Collective QoS\cite{qos_specific_wsn} and comprises parameters such as collective bandwidth, average throughput and the number of devices requiring replacement. As this information eventually requires accumulation on a single machine in order to determine concrete values, aggregation of expansive volumes of auxiliary sensor data must be aggregated intelligently as not to form a congestion point or single point of failure.

However, device level information is still required alongside of collective QoS. If a device is not performing according to expectations of a predetermined strategy, it is required that this is mitigated or notified. This introduces a second distinction to classical QoS: multi-level monitoring and reporting. Conventionally, only the QoS provided by the server(s) running am application is of interest. However in a wireless sensor environment, monitoring parameters on different levels is required. Examples of these monitoring levels are single sensor, the application as a whole, analysis per IoT cell tower or geographic area. This requirement entails data points of different levels of enrichment, calculated from the same raw sensor data.

The final distinction in IoT monitoring is the dynamic nature of WSN applications. An IoT monitoring application needs to be prepared for devices added to the network and dropping out of the application. As a collective QoS parameter is based on a selection of devices, the monitoring application must support adding and remove devices from the equation.

In conclusion IoT QoS management will require a flexible and dynamic method of resource parameter modelling. Additionally this process should be able to be applied to a high influx of sensor date. This monitoring technique should be able to calculate both lower level (single sensor) and higher level (application) resource distribution.

\subsubsection{Movement to operated cell network}
A final challenge in contemporary QoS monitoring of LPWA applications is the earlier recognised increasing trend of commercial telecom operated cell networks. Though is makes IoT connectivity more efficient because many applications can be served by a single network infrastructure, it  effects difficulties to QoS. Firstly, Many applications will be competing for a shared scarce amount of network resources. When other applications consume a large portion of the resources, due to poor rationing or event-bursts, your application suffers and cannot provide expected QoS.

Secondly, by out-sourcing the network infrastructure, control over the network is lost. Though beneficiary to the required effort, some important capabilities are conceded. For example the network can no longer be easily altered in order to suit the needs of the application. Additionally, auxiliary data can not be extracted from the network and edge computing is not an option, deferring the burden of aggregating QoS data entirely on back-end.

Finally, the telecom operator will require adherence to a Service Level Agreement (SLA). Though this ensures a certain service provided to an application and prevents other applications of consuming extraneous resources, it also requires close monitoring of applications. A breach of the SLA may cause fines or dissolving of a contract. Therefore, strict adherence to the SLA parameters is necessary and timely proactive intervention is required, if the limits of the SLA are threatened to be exceeded.\cite{cloud_computing_monitoring}

To summarize, outsourcing the management of the network infrastructure to a professional telecom provider aggravates the need for exact and real-time curtailment of digital resources, while simultaneously impeding the ability to do so in the network itself. This will need to be remedied by adapting the parts of the WSN architecture within the domain of control, i.e. the sensor devices and the back-end application. Because of the earlier proposed concerns and challenges this increased responsibility will be mostly attributed to the back-end application.

%\subsubsection{Summary}
%In conclusion, The tendency to defer computations challenges the computing capabilities of centralized solutions. This inability for pre-computation, combined with immense input numbers of LPWA device data, entails a design with a deliberate focus on scalability of throughput. Additionally measuring and controlling QoS in Wireless Sensor networks is very different from measuring and controlling QoS in resource-abundant networks. Both because of the resource constraints and the fact that the QoS characteristics in WSN's are different from the characteristics in conventional networks and applications. Finally, by outsourcing the responsibility of network management, the ability to control and observe those networks is also lost.

%To this purpose we will research the applicability and design of a WSN QoS platform. This platform should address the issues of scalability and limitations of source devices and in-network processing. It should be noted however that we will not address the issues of end-device resource restriction and network obscuration directly, only the challenges it imposes on the task of QoS monitoring and control.

\section{Current State of the Art}
The previous section illustrated some key challenges in measuring and determining QoS in WSNs. This section will deliberate on some known QoS protocols and existing monitoring solutions. It will conclude by arguing why the current state of the art does not provide a suitable solution for the previously identified challenges.

%TODO check met begeleiders: protocols weggooien?
\subsection{QoS protocols}
\label{sec:qos-protocols}
The first well known protocol often employed for QoS monitoring is SNMP\cite{snmp}. SNMP provides a formalized, device-independent addressing scheme to request key device and networking datapoints. Additionally, it allows application developers to specify custom addressable datapoints. Though SNMP does not feature command and control capabilities, the information obtained by it can be used to configure and control an application by other means.

A protocol that does feature such command \& control capabilities is Integrated Services (IntServ)\cite{intserv_diffserv_uitleg}. This protocol negotiates a resource allocation in the network per data flow. This allocation is then permeated throughout the network domain and retained until the data flow has ended. It provides hard QoS guarantees within the network, but at a severe preparation cost and overhead.

A more cost-efficient QoS protocol is Differentiated Services (DiffServ)\cite{intserv_diffserv_uitleg}. This protocol does not require resource negotiation and instead identifies differentiating traffic classes. Depending on the determined class, the data will enjoy specific benefits such as priority handling or increased network resources allocation. Though the QoS guarantees provided by this protocol are softer than that of IntServ, it also generates vastly less overhead.

The former protocols are all general application networking protocols. Though there are proposals for IoT-specific QoS monitoring frameworks. A promising solution is presented by R. Duan et al\cite{qos_extensive_architecture}. This framework aims for an automated negotiation procedure between node, network and back-end layers in order to deliberate a reporting level that compromises the monitoring needs with the available resources and device capabilities. In this manner it can offer the greatest benefit to QoS without considerably impacting it negatively.
%TODO cites

\subsection{QoS platforms}
Aside from protocols managing QoS there also exist some IoT platforms that are capable of (or enable) some form of QoS monitoring. This section will detail three of them and how they curtail the posed challenges or are invalidated by them.
\subsubsection*{PTC ThingWorx}
PTC ThingWorx\cite{web:thingworx} is a proprietary IoT PaaS solution developed by PTC. It is a full-scale cloud platform offering many pre-packaged IoT support services. The focus of this platform is on rapid application design, development and deployment. The aim of the ThingWorx team is to offer the ability to develop IoT applications without coding and instead device an application by only using the ThingWorx application interface. This simplifies the development cycle and shortens time-to-market\cite{study_of_various}. Though it is perfectly capable of monitoring the performance of an application, the focus of the platform is on application development and data management. Therefore employing it for performance monitoring only might be a disproportionate approach, especially considering that ThingWorx is a paid platform. Additionally, only using a small section of the platform's functions might lead to installing bulky, cumbersome agents in sensor devices. This will potentially unnecessarily consume resources of a constraint device. Aside from the previously mentioned extravagances, sources report that ThingWorx has scalability problems\cite{good_assessment}.% and difficulties with technical expertise and communication in their professional services devision\cite{forrester}.

\subsubsection*{Cisco Jasper Control Center}
Cisco has extended its Jasper cloud platform and has optimized it for several IoT markets. This extension includes a product specifically designed for LPWA IoT applications named the Control Center for NB-IoT\cite{cisco_jasper}. It is specifically designed for SIM-connected (LTE) device connectivity management\cite{forrester}. It accomplishes this through Cisco's proprietary network hardware and partnerships with mobile operators that incorporate data extraction end-points in their devices. Jasper therefore focuses on data and information obtained from network nodes and edge computation instead of communicating with actual end-devices. This decrease the burden on resource constraint devices and alleviates the challenge posed by the movement to provider operated cell networks. However, in doing so it neglects information that can only be acquired by node inspection. 

Jasper Control Center allows the usage of business rules for information extraction and actuation, and can employ outbound communication channels (e.g. email or SMS) for alerting purposes.  In addition it includes API's for more complex further analyses. Jasper Control Center is a proprietary SaaS solution which can be procured in packages. However the basic packages seems to only include minimal functionality and more advanced functions such as rule-based automation and third party API access are sold in separate additional packages\cite{cisco_jasper}. Finally, Jasper Control Center can report on a few Collective QoS parameters (e.g. data usage, number of reports received), but it has been reported that Jasper lacks in analytic functionality\cite{forrester}.

\subsubsection*{Nimbits}
Nimbits\cite{web:nimbits} is an open-source cloud data logger and analysis PaaS. It employs a rule-based engine to filter, log and process incoming data. Additionally, rules can be defined to instruct the engine to report alerts via external communication channels. It operates by defining data points to which sensors and servers can write and read data\cite{study_of_various, nimbits_mqtt}. Devices can do so by employing a Nimbits client or via HTTP API's. It has been reported that Nimbits can communicate via the light-weight MQTT protocol\cite{nimbits_mqtt}, but documentation demonstrating this is lacking. It therefore appears that Nimbits lacks the considerations required for resource constraint LPWA devices.

Nimbits is not primarily intended as a QoS monitoring platform, but can be configured as such by regarding auxiliary QoS data as primary data of a dedicated QoS monitoring application. However, after analysing Nimbits's design of data points, Nimbits seems to be most appropriate for applications with a small pool of distinct sensor types. Establishing and managing data points fora colossal amount of devices of equivalent data types, as a monitoring job will often encompass, rapidly becomes a cumbersome effort to automate.

%TODO zoveel mogelijk referenties naar challenges
\subsection{Deficiencies in current state of art}
\subsubsection{QoS protocols}
The protocols described in Section \ref{sec:qos-protocols} are unfortunately not applicable to the LPWA WSN domain. Firstly, SNMP operates according to a master-slave architecture which requires slaves (sensor nodes) to remain on-line permanently (or at least regularly)\cite{snmp_server_initiated}. This demand is invalidated by the resource restriction complication featured in LPWA applications. This can be partly alleviated by proxying the sensor devices by a proxy that is less resource constrained. This would however come at the cost of a lack of real-time data or delayed response times\cite{snmp_proxy}. Therefore, a more appropriate solution would be to employ a client-initiated approach. Furthermore, SNMP and related protocols consider end-to-end QoS. As discussed in Section \ref{sec:challenges}, WSN application monitoring must consider both end-to-end and collective QoS. Therefore, even if SNMP is employed, further processing is required.

Though IntServ's hard QoS guarantees are powerful, the overhead required to establish these flows is far too imposing\cite{intserv_diffserv_too_complex}. Since LPWA only sends small message payloads, the heavy per flow negotiation data will easily exceed the payload data. With LPWA's limited resources in mind this cannot be considered as an efficient solution. Conversely, DiffServ does not feature this immense overhead cost. However, application of the protocol is complicated by the movement to commercial network operators, as it would require them to implement a class-based allocation system in their networks. The previously mentioned inhibitions are potentially aggravated by local net neutrality laws. Though this was not a concern in privately operated proprietary networks, in universal Internet of Things extreme networks severe net neutrality laws may prohibit priority treatment of data flows based on their source, destination or content.\cite{net_neutrality} This implies that the required QoS guarantees cannot feasibly or legally be (fully) provided by a commercial Internet of Things network provider and in-network protocols. 
%TODO citesdiffserv

Furthermore, both IntServ and DiffServ consider only network QoS, therefore they lack the level of inspection to report or consider the state of limited resources in end-devices. This deficiency also troubles IoT-specific QoS protocols. Most efforts are focussed towards efficient and effective networking in order to facilitate increasing data-rates. These protocols disregard important device metrics, such as node lifetime and sensor measurement accuracy, which are paramount to determining the health and performance of an IoT application. Finally, though the protocol of R. Duan et al\cite{qos_extensive_architecture} does feature this level of inspection, the details require further implementation to fully complete the protocol. Since the field of IoT is relatively young, no such IoT-specific QoS procedures have matured to a uniform and universal internet standard. From the preceding it is concluded that contemporary general purpose or IoT-specific QoS protocols cannot provide for an adequate in-network solution. Instead this obligation is imposed on the back-end and the end-devices.

%TODO check footnote is on page
%TODO plaatsing
\subsubsection{QoS platforms}
\begin{table*}[t]
\centering
\begin{tabular}{|l|c|c|c|c|c|} \hline
 & ThingWorx & Cisco Jasper & Nimbits \\ 
 & & Control Center & \\ \hline
LPWA specific\footnote{I.e. constained by resource limitations} & \xmark & \cmark &  \xmark \\ \hline
QoS monitoring focus & \xmark & \xmark & \xmark \\ \hline
Open-source & \xmark & \xmark & \cmark \\ \hline
Device-level inspection & \cmark & \xmark & \cmark \\ \hline
Extreme scalability & \xmark & \cmark & \xmark \\ \hline
\end{tabular}
\caption{Comparative analysis of IoT QoS monitoring platforms}
\label{table:platform_assessment}
\end{table*}

An assessment of the discussed platforms and their applicability to the field of LPWA is depicted in table \ref{table:platform_assessment}. It shows that these platforms are all lacking in some important considerations. These platforms are either not conceived with a focus on LPWA's severe resource constraints, a primary focus on resource and QoS monitoring or the extreme scale of contemporary WSN applications\cite{platforms,forrester,study_of_various,good_assessment}.

These deficiencies make the existing monitoring platforms insufficient solutions for monitoring and controlling large scale LPWA IoT applications. This implies that the technologies are either inapplicable or require a composition of these technologies. This complication of the technology stack could be acceptable for a key function of an application, but not for an auxiliary monitoring processes. As not to complicate a software product which does not enjoy the main focus of development efforts it would be beneficiary to have a single platform which enables its development. The preceding concludes a vacancy in the current state of the art. The remainder of this chapter will be devoted to how this vacancy is proposed to be absolved.

\section{Contribution of the Thesis}
The preceding sections have demonstrated that LPWA-specific challenges leave a deficiency in WSN QoS monitoring and management which contemporary QoS management solutions cannot absolve. This section will proposition how the deficiency in the current state of affairs is aimed to be abridged. First, the overall goal of this thesis will be clearly stated. After which, the goal will be explicated in to distinct research questions. Finally, the general approach to absolve this deficiency will be covered shortly.
\subsection{Goal}
\label{sec:goal}
The goal of this study is to research and develop a development platform providing capabilities of measuring and monitoring QoS parameters of LPWA WSN applications. This platform will be devised to overcome the challenges identified in Section \ref{sec:challenges}. To re-iterate, these core challenges are: the deference of processing to the back-end, due to restricted processor capabilities and obscuration of the network, and the unique QoS challenges in WSN networks such as multi-level abstractions and aggregation of massive amounts of multi-sourced snapshots. The platform to be designed will enable development of support applications that process auxiliary IoT data. This data is raw and low-level, but is enriched by the platform by associating streaming data with data obtained from relevant data sources and aggregating streaming data to infer higher-level information. This information can be exported for reporting and visualization purposes, can alter the state of a system (single sensor, group of sensors, entire application, etc.) and can cause alerts to be dispatched for immediate intervention.

\subsection{Research questions}
To accomplish the goal set out for this study the following question require answering.
\begin{enumerate}[leftmargin=24pt, label=\small RQ\arabic*]
\nospace
\item\label{rq:identify_processes} What are the key data transformations and operations that are performed on (auxiliary) data streams produced by WSNs?
\item\label{rq:desing_processes} How to design a platform that facilitates the identified WSN data streams, transactions and operations?
\item\label{rq:abstraction} What is the appropriate level of abstraction for a WSN monitoring platform, such that
\begin{itemize}
\nospace
\item the platform is applicable to monitoring a large domain of WSNs,
\item provides for minimal development effort, and
\item supports evolution of the application.
\end{itemize}
\item\label{rq:identify_scale} What are the challenges regarding scalability in a WSN data stream processing platform?
\item\label{rq:design_scale} How can these challenges be overcome?
\item\label{rq:idenfity_model} What are the key concepts regarding modelling and calculation of QoS parameters?
\item\label{rq:design_model} How can the state of a system with variable behaviour be modelled?
\item\label{rq:solve_model} How can the optimal system behaviour be determined, in accordance with its state?
\end{enumerate}

The listed research questions feature a focus that is twofold. The first point of focus is the design and development of an abstract, scalable streaming platform for IoT data enrichment. The associated questions are RQ1-5. It concerns the appropriate abstraction of a platform combatting the challenges in iteratively refining low-level sensor data to high-level information with business value and scalability due to the vast amount of data generated by the WSN.  The second focal point concerns the representation and processing of information depicting the state of a system under investigation. This entails capturing some data points produced by sensor devices or intermediary processes, calculating the derived parameters from those measurements and producing a decision in accordance with the model's values and set rules. This focal point is represented by research questions RQ6-8.

\subsection{Approach}
With the goal and research questions defined, The general method intended to accomplish this goal will be clarified.

As the previous section mentioned, the research questions can be divided into two categories: The design of the platform and modelling the distribution of resource and QoS parameters. The approach is therefore to research these individually before integrating the efforts into one resulting software development platform. First, the design of a processing platform architecture will be explored. This platform endeavours to compete the challenge of immense influx of data. Additionally, it will feature multi-stage calculation and enrichment in order to provide for the need of multi-level QoS processing and reporting. Consequently, modelling method capable of captivating the distribution of resources and interconnectivity of QoS will be researched. This model will again take into account the multi-level modelling needs in accordance with the identified challenge. Additionally it will combat the challenge of enriching deferred low-level data to high level usable information by allowing transformations of resource parameters. 

Each individual point of focus will be devised, designed and developed according to the following schedule. First, the problem domain of the to be designed artefact will be explored. This will be performed with a commonality/variability analysis (Section \ref{sec:back:cv_analysis}). This analysis allows the determination of the appropriate level of abstraction. This analysis will result in a list of requirements for the solution to adhere to. With the requirements defined the state of the art of the problem domain will be explored to identify viable technologies and their deficiencies, before selecting the best applicable technologies. With these technologies identified they will be adapted and the intended artefact will be designed and developed. Ultimately, the devised solution will be evaluated and discussed by paralleling them to the set requirements and some additional concepts and criteria. 
%For design and development the iterative development approach of Design Science Methodology\cite{dsm} (Section \ref{sec:back:dsm}) will be adopted.

Finally the conceived model will be incorporated in the larger context of the developed platform architecture. Once the two compounds have been integrated into a single solution, the challenges it claims to combat will need verifying. A proof-of-concept validation study will be performed by applying the platform to a real-world commercial car park WSN application developed and operated by the Dutch company Nedap N.V. This will be achieved by providing a prototype implementation of the constructed platform. The development efforts and applicability of the development platform will be evaluated according to preconceived criteria.

\section{Thesis organization}
The remainder of this thesis is structured as follows. Chapter 2 will briefly elaborate on some background concepts required for the understanding of this thesis. Chapter 3 will depict the design of the proposed distributed architecture for the QoS monitoring platform. In Chapter 4 the proposed model capable of calculating the state and optimal performance of a system will be discussed. The two aforementioned artefacts will enjoy a preliminary validation in a proof-of-concept study in Chapter 5. Finally, the thesis will be concluded in Chapter 6, which will discuss the efforts and results of this study, and will provide suggestions for continued research.